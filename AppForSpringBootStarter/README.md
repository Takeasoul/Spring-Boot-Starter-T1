# Описание проекта AOP (logging, error catcher, execution time)

## Поставленная задача

Создайте аннотации `@TrackTime` и `@TrackAsyncTime`, которые можно применять к методам для отслеживания времени их выполнения.
Реализуйте аспекты, используя Spring AOP, для асинхронного и синхронного отслеживания времени выполнения методов, помеченных соответствующими аннотациями.
Создайте сервис, который будет асинхронно сохранять данные о времени выполнения методов в базе данных.
Реализуйте REST API для получения статистики по времени выполнения методов (например, среднее время выполнения, общее время выполнения) для различных методов и их групп.
Настройте приложение с помощью конфигурации Spring для включения использования AOP и асинхронной обработки данных.

## Решение

Разработынный проект  - это система для отслеживания времени выполнения методов в приложении, разработанная с использованием Java и Spring Framework. Он включает в себя следующие компоненты:

1. **Отслеживание времени выполнения методов**: Проект использует Spring AOP (Aspect-Oriented Programming) для отслеживания времени выполнения методов, помеченных аннотациями `@TrackTime` (Для синхронных методов) и `@TrackAsyncTime` (Для ассинхронных методов). Для этого используются аспекты, которые перехватывают вызовы методов и регистрируют время их выполнения.

2. **Асинхронное сохранение данных**: Для асинхронного сохранения данных о времени выполнения методов в базе данных используется сервис, который выполняет эту задачу. Это позволяет избежать блокировки основного потока выполнения и повысить производительность приложения.

3. **Логгирование выполняемых методов**: Была создана анотация `@Logging`, выполняемая у всех `public` методов сервисов проекта. Логгируются такие данные как: название метода, название класса, входные данные, результат.

4. **"Ловитель" ошибок**: Была создана анотация `@ErrorCatch`, выполняемая у всех `public` методов сервисов проекта. В случае, если метод выбрасывает исключение, аспект ловит его и сохраняет ассинхронно в БД информацию об ошибке, если же данная ошибка уже была зафиксирована ранее, то новая запись не добавляется, а изменяется число `error_count` у существующей записи.

5. **Операции для взаимодействия с мероприятиями (Events) и участниками (Events-members)**: В проекте также реализован CRUD (Create, Read, Update, Delete) интерфейс для управления данными. Этот функционал позволяет добавлять, просматривать, обновлять и удалять информацию о мероприятиях/участниках в базе данных.

## API документация

### I. Запрос для получения среднего времени выполнения всех методов
1. *Тип запроса* - Get;
2. *Параметры* - без параметров;
3. *Пример ответа* -
```   
   [
   {
   "methodName": "string",
   "timeTaken": 0
   }
   ]
```
4. *Метод контроллера*
```java
@Operation(summary = "Получить среднее время выполнения всех методов помеченными аннотациями @TrackTime и @TrackAsyncTime")
@GetMapping("/average-execution-time-methods")
public ResponseEntity<List<ExecutionTimeMethodDto>> getStatistics() {
    return ResponseEntity.ok(statisticsService.getAverageExecutionTimeMethods());
}
```

### II. Запрос для получения методов в которых была выброшена ошибка и кол-во этих ошибок
1. *Тип запроса* - Get;
2. *Параметры* - без параметров;
3. *Пример ответа* -
```   
   [
   {
   "methodName": "string",
   "timeTaken": 0
   }
   ]
```
4. *Метод контроллера*
```java
@Operation(summary = "Получить максимальное время выполнения всех методов помеченными аннотациями @TrackTime и @TrackAsyncTime")
@GetMapping("/max-execution-time-methods")
public ResponseEntity<List<MethodsTimeResponse>> getMaxStatistics() {
    return ResponseEntity.ok(statisticsService.getMaxExecutionTimeMethods());
}
```

### III. Запрос для получения методов в которых была выброшена ошибка и кол-во этих ошибок
1. *Тип запроса* - Get;
2. *Параметры* - без параметров;
3. *Пример ответа* -
  ``` 
   [
   {
   "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
   "errorMessage": "string",
   "errorClass": "string",
   "errorCount": 0
   }
   ]
   ```
4. *Метод контроллера*
```java
@Operation(summary = "Получить методы и количество ошибок, возникших в данных методах")
@GetMapping("/get-error-log")
public ResponseEntity<List<ErrorLog>> getErrorLog() {
    return ResponseEntity.ok(errorLogService.getErrorLog());
}
```




## Запуск проекта

### Требования

- Docker
- Docker Compose

1. Склонируйте репозиторий на свой компьютер:

    ```bash
    git clone https://github.com/Takeasoul/AOP-Spring-T1.git
    ```

2. Перейдите в каталог проекта:

    ```bash
    cd AOP-Spring-T1
    ```

3. Соберите и запустите контейнеры Docker с помощью Docker Compose:

    ```bash
    docker-compose up --build
    ```

### Порты и доступы

- **PostgreSQL**:
    - **Порт:** 5432
    - **База данных:** T1Open1th
    - **Пользователь:** postgres
    - **Пароль:** admin
    - **Адрес:** localhost:5432

- **Backend приложение**:
    - **Порт:** 8080
    - **Адрес:** localhost:8080
    - **OpenAPI:** [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)
    - **Конфигурация:** `application.yaml`

  

